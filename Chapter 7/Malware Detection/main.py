import numpy as np
import pandas as pd
import pickle
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
from sklearn.metrics import classification_report

data = pd.read_csv('dataset/dataset_train.csv')

# print(data.info())
print(data.head(10))

df = pd.DataFrame(data)

X = df.drop(['Name', 'Machine', 'TimeDateStamp', 'Malware'], axis=1)
y = df['Malware']

X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42, stratify=y
)
# print(f'Number of features used from the dataset is {X_train.shape[1]}')

rfc = RandomForestClassifier(
    n_estimators=100, random_state=0, oob_score=True, max_depth=16
)
rfc.fit(X_train, y_train)

y_pred = rfc.predict(X_test)
print(classification_report(y_test, y_pred,
      target_names=['Benign', 'Malware']))

test_data = pd.read_csv("dataset/dataset_test.csv")

X_pred = test_data.drop(['Name', 'Machine', 'TimeDateStamp'], axis=1)
predictions = rfc.predict(X_pred)

results = pd.DataFrame(
    {'File Name': test_data['Name'], 'Model Prediction': predictions}
)
print(results)

pkl_filename = "RF_model.pkl"
with open(pkl_filename, 'wb') as file:
    pickle.dump(rfc, file)
